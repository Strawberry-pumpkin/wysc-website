{% extends "profiles/base.html" %}
{% block content %}
    <div>
        {% if participants.exists %}
            <p>Currently you are registered for the following tournaments:</p>
            {% for p in participants %}
                <div class="mt-5 p-5 bg-white rounded-lg shadow-md">
                    <div class="border-b pb-3 mb-3"><h4 class="text-lg font-semibold">{{p.tournament.name}}</h4></div>
                    <div>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-2 font-medium">Venue:</div>
                            <div class="col-span-10">{{p.tournament.venue}}</div>

                            <div class="col-span-2 font-medium">Start Date:</div>
                            <div class="col-span-10">{{p.tournament.start_date}}</div>

                            <div class="col-span-2 font-medium">Registered as:</div>
                            <div class="col-span-10">{{ p.name }}</div>

                            <div class="col-span-2 font-medium">Payment:</div>
                            <div class="col-span-10">
                                {% if p.approval == 'V' %}
                                    <strong>{{ p.get_approval_display }}</strong>
                                {% elif p.approval == 'P' %}
                                    {{ p.get_approval_display }}<br/>
                                    {{ p.payment.name }}
                                {% else %}
                                    {{ p.get_approval_display }}
                                {% endif %}
                            </div>
                        </div>
                        {% if p.approval == 'P' %}
                            <p class='mt-5'>Thank you for the payment. Once your payment has been verified, the status will change here from 'Pending Verification' to 'Verified'</p>
                        {% elif p.approval == 'V' %}
                            <p class='mt-5'>Your registration is complete.</p>
                        {% else %}
                            <p class="mt-5">If the above information is correct, please transfer your payment to the account given below and upload the payment slip/transfer confirmation.
                                If the above information is not correct (for example, if you are registered for the wrong zonal), please <a href="/profile/" class="text-blue-500 underline">click here</a> to change it.
                                The entry fee is Rs {{p.tournament.fee}}
                            </p>
                            <p class="ml-5">
                                <strong>Bank</strong> : Commercial Bank<br/>
                                <strong>Branch</strong> : Islamic Banking Unit<br/>
                                <strong>Name</strong> : Scrabble Federation of Sri Lanka<br/>
                                <strong>Account Number</strong> : 1000675595<br/>
                            </p>

                            <p>You can transfer the funds through online banking facilities or the deposit can be made in person at any branch of Commercial Bank.</p>
                            
                            <form method="post" enctype="multipart/form-data" class="file-upload-form">
                                {{ p.form.errors }}
                                {% csrf_token %}
                                <label for="id_payment" class="block font-medium text-sm text-gray-700">Payment details (deposit slip or transfer confirmation):</label>
                                <input type="file" name="payment" accept="image/*, .pdf" id="id_payment-{{p.tournament.id}}" 
                                    class="form-input mt-1 block w-full">
                                <button type="submit" class="mt-2 btn btn-primary bg-blue-500 text-white py-2 px-4 rounded-md disabled:opacity-50" disabled
                                    id="submitButton-{{p.tournament.id}}">Upload</button>
                                {{ p.form.tournament }}
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
                <p>You are not registered for any tournaments.</p>
        {% endif %}
        
        <script>
            const fileInputs = document.querySelectorAll('.file-input');

            // Loop through each file input
            fileInputs.forEach(function(input) {
                // Add event listener for each input
                input.addEventListener('change', function(event) {
                    // Get the parent form of the file input
                    const form = event.target.closest('.file-upload-form');
                    
                    // Find the submit button within the parent form
                    const submitButton = form.querySelector('.upload-button');
                    
                    // Enable the submit button if a file is selected, otherwise disable it
                    if (event.target.files.length > 0) {
                        submitButton.disabled = false;
                    } else {
                        submitButton.disabled = true;
                    }
                });
            });
        </script>
    </div>
{% endblock %}
